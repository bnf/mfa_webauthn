define(["lit-element"],(function(e){"use strict";const t=e=>{const t=(e=e.replace(/-/g,"+").replace(/_/g,"/")).length%4;if(t){if(1===t)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");e+=new Array(5-t).join("=")}return window.atob(e)},i=e=>btoa(String.fromCharCode(...e)),n=e=>(e.challenge=Uint8Array.from(t(e.challenge),(e=>e.charCodeAt(0))),void 0!==e.user&&(e.user={...e.user,id:Uint8Array.from(window.atob(e.user.id),(e=>e.charCodeAt(0)))}),void 0!==e.excludeCredentials&&(e.excludeCredentials=e.excludeCredentials.map((e=>({...e,id:Uint8Array.from(t(e.id),(e=>e.charCodeAt(0)))})))),void 0!==e.allowCredentials&&(e.allowCredentials=e.allowCredentials.map((e=>({...e,id:Uint8Array.from(t(e.id),(e=>e.charCodeAt(0)))})))),e),a=e=>{const t={id:e.id,type:e.type,rawId:i(new Uint8Array(e.rawId)),response:{clientDataJSON:i(new Uint8Array(e.response.clientDataJSON))}};return void 0!==e.response.attestationObject&&(t.response.attestationObject=i(new Uint8Array(e.response.attestationObject))),void 0!==e.response.authenticatorData&&(t.response.authenticatorData=i(new Uint8Array(e.response.authenticatorData))),void 0!==e.response.signature&&(t.response.signature=i(new Uint8Array(e.response.signature))),void 0!==e.response.userHandle&&(t.response.userHandle=i(new Uint8Array(e.response.userHandle))),t};class r extends HTMLElement{connectedCallback(){const e=document.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("name","webauthn_publicKeyCredential"),this.appendChild(e);let t=this.parentElement;for(;"form"!==t.tagName.toLowerCase();)t=t.parentElement;const i=n(JSON.parse(this.getAttribute("credential-request-options")));t.addEventListener("submit",(n=>{e.value||(n.preventDefault(),navigator.credentials.get({publicKey:i}).then((i=>{e.value=JSON.stringify(a(i)),t.requestSubmit()}),(e=>{console.log(e)})))})),t.requestSubmit()}}window.customElements.define("mfa-webauthn-authenticator",r);class s extends e.LitElement{static get properties(){return{mode:{type:String},credentials:{type:Object},credentialCreationOptions:{type:Object,attribute:"credential-creation-options"},labels:{type:Object},publicKeyCredential:{type:String,attribute:!1},publicKeyDescription:{type:String,attribute:!1},publicKeyIcon:{type:String,attribute:!1},action:{type:String,attribute:!1},loading:{type:Boolean,attribute:!1}}}render(){const t="add"===this.action?"fa-check":this.loading?"fa-circle-o-notch fa-spin":"fa-plus";return e.html`<input type="hidden" name="webauthn_publicKeyCredential" .value="${this.publicKeyCredential}"> <input type="hidden" name="webauthn_publicKeyDescription" .value="${this.publicKeyDescription}"> <input type="hidden" name="webauthn_publicKeyIcon" .value="${this.publicKeyIcon}"> <input type="hidden" name="webauthn_action" .value="${this.action}"> ${0===Object.keys(this.credentials).length?e.html`<div class="callout"><h4 class="callout-title">No ${this.labels.plural} added</h4><div class="callout-body">Configure ${this.labels.plural} below</div></div>`:e.html`<table class="table" style="max-width:450px;word-break:break-all"><thead><tr><th class="col-icon"><button class="btn btn-default" @click="${this._createCredentials}"><i class="fa ${t} fa-fw"></i></button></th><th colspan="2">Registered ${this.labels.plural}</th></tr><tr></tr></thead><tbody>${Object.keys(this.credentials).map((t=>e.html`<tr id="credential-${t}"><td class="col-icon">${this._getIcon(this.credentials[t].icon||"key")}</td><td class="col-title">${this.credentials[t].description||"(unnamed)"}<br><span class="text-muted">Last used: ${this._formatDate(this.credentials[t].updated)}</span></td><td class="col-control"><div class="btn-group" role="group"><button class="btn btn-danger" title="Remove ${this.labels.singular}" @click="${e=>this._removeCredentials(e,t)}"><i class="fa fa-trash fa-fw"></i></button></div></td></tr>`))}</tbody></table>`} <button class="btn btn-default btn-lg" @click="${this._createCredentials}"><i class="fa ${t} fa-fw"></i> Add ${this.labels.singular}</button>`}createRenderRoot(){return this}connectedCallback(){for(this.publicKeyCrendetial="",this.publicKeyDescription="",this.action="",this.form=this.parentElement;"form"!==this.form.tagName.toLowerCase();)this.form=this.form.parentElement;super.connectedCallback(),"setup"===this.mode&&this._createCredentials()}_createCredentials(e){e&&e.preventDefault();const t=n(JSON.parse(JSON.stringify(this.credentialCreationOptions)));this.loading=!0,navigator.credentials.create({publicKey:t}).then((e=>{this.action="add",this.publicKeyCredential=JSON.stringify(a(e)),this.publicKeyIcon="key";let t=this.labels.defaultName;if("platform"===this.credentialCreationOptions.authenticatorSelection.authenticatorAttachment){const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);t="My "+(e?"Phone":"Computer"),this.publicKeyIcon=e?"mobile":"computer"}const i=window.prompt("Please provide a name for this "+this.labels.signular+".",t);this.publicKeyDescription=i,this.loading=!1,this.updateComplete.then((()=>this.form.requestSubmit()))}),(e=>{this.loading=!1,console.log(e)}))}_removeCredentials(e,t){e.preventDefault(),this.action="remove";const i=this.credentials[t].description||"(unnamed)";window.confirm("Do you really want to delete the "+this.labels.singular+' "'+i+'"?')&&(this.publicKeyCredential=JSON.stringify(this.credentials[t].publickey),this.updateComplete.then((()=>this.form.requestSubmit())))}_formatDate(e){if(!e)return"never";const t=new Date(1e3*e);return t.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})+" "+t.toLocaleTimeString("en-US")}_getIcon(t){return"mobile"===(t=t)?e.html`<svg viewBox="0 0 24 24" fill="#000" width="24" height="24"><path d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"/></svg>`:"computer"===t?e.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#000" width="24" height="24"><path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/></svg>`:e.html`<svg width="16" height="37.66" viewBox="0 0 48 113"><path d="M24.53 59.303c6.764.01 12.255-5.488 12.266-12.282.011-6.793-5.463-12.31-12.226-12.32-6.763-.01-12.255 5.488-12.265 12.281-.012 6.793 5.463 12.31 12.226 12.32zm.085-52.347c-2.959-.005-5.36 2.4-5.366 5.371-.004 2.972 2.39 5.384 5.348 5.39 2.958.004 5.36-2.4 5.365-5.372.005-2.972-2.39-5.385-5.347-5.39zM.129 2.6A2.607 2.607 0 012.727 0L45.41.069A2.607 2.607 0 0148 2.679l-.13 80.894a2.607 2.607 0 01-2.597 2.602l-5.2-.01-.038 24.234A2.6 2.6 0 0137.437 113l-27.097-.044a2.6 2.6 0 01-2.59-2.61l.039-24.232-5.2-.008A2.607 2.607 0 010 83.496L.13 2.601z" fill="#000" fill-opacity=".4"/></svg>`}}window.customElements.define("mfa-webauthn-setup",s)}));
